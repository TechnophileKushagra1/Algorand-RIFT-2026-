<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Muse v2 â€” NFT + RWA Marketplace on Algorand</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Syne+Mono&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN TOKENS â€” Dark Obsidian + Gold Meridian
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --bg0:      #08090d;
      --bg1:      #0f1119;
      --bg2:      #161924;
      --bg3:      #1e2230;
      --bg4:      #262b3a;
      --line:     #2a2f42;
      --text0:    #edeef5;
      --text1:    #b8bcd4;
      --text2:    #7a7f9a;
      --text3:    #4a4e65;

      --gold:     #d4a843;
      --gold2:    #f0c96a;
      --gold3:    #a07820;
      --amber:    #e07b1a;
      --crimson:  #cc3a3a;
      --emerald:  #1fa86e;
      --sapphire: #2d7fca;
      --violet:   #7c4dcc;
      --rose:     #c94d8a;

      /* Role colors */
      --athlete:  #d4a843;
      --league:   #2d7fca;
      --charity:  #1fa86e;
      --media:    #7c4dcc;

      --r: 3px;
      --sh: 0 8px 32px rgba(0,0,0,0.5);
      --sh2: 0 2px 12px rgba(0,0,0,0.4);
    }

    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    html { scroll-behavior: smooth; }

    body {
      background: var(--bg0);
      color: var(--text0);
      font-family: 'Syne', sans-serif;
      font-weight: 400;
      line-height: 1.6;
      min-height: 100vh;
      background-image:
        radial-gradient(ellipse 80% 40% at 50% -10%, rgba(212,168,67,0.08) 0%, transparent 70%),
        radial-gradient(ellipse 40% 60% at 90% 50%, rgba(45,127,202,0.05) 0%, transparent 60%);
    }

    /* â”€â”€ SCROLLBAR â”€â”€ */
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: var(--bg1); }
    ::-webkit-scrollbar-thumb { background: var(--bg4); border-radius: 10px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NAVIGATION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    nav {
      position: sticky; top: 0; z-index: 200;
      background: rgba(8,9,13,0.85);
      backdrop-filter: blur(20px) saturate(1.5);
      border-bottom: 1px solid var(--line);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 2.5rem;
      height: 64px;
    }
    .nav-brand {
      display: flex; align-items: center; gap: 12px;
      font-family: 'Instrument Serif', serif;
      font-size: 1.6rem;
      letter-spacing: -0.5px;
    }
    .nav-gem {
      width: 32px; height: 32px;
      background: linear-gradient(135deg, var(--gold3), var(--gold2));
      clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.7rem; color: var(--bg0);
      font-family: 'Syne Mono', monospace;
      animation: gemPulse 3s ease-in-out infinite;
    }
    @keyframes gemPulse {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3) drop-shadow(0 0 8px rgba(212,168,67,0.6)); }
    }
    .nav-badge {
      font-family: 'Syne Mono', monospace;
      font-size: 0.6rem;
      letter-spacing: 1px;
      background: linear-gradient(90deg, var(--gold3), var(--gold));
      -webkit-background-clip: text; background-clip: text;
      -webkit-text-fill-color: transparent;
      border: 1px solid var(--gold3);
      padding: 2px 7px;
      border-radius: 20px;
      margin-left: 4px;
    }
    .nav-tabs {
      display: flex; gap: 2px;
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 4px;
    }
    .nav-tab {
      padding: 6px 16px;
      font-size: 0.78rem; font-weight: 600;
      letter-spacing: 0.4px;
      color: var(--text2);
      cursor: pointer;
      border-radius: 5px;
      border: none; background: none;
      transition: all 0.2s;
    }
    .nav-tab:hover { color: var(--text0); background: var(--bg3); }
    .nav-tab.active { color: var(--bg0); background: var(--gold); }
    .nav-right { display: flex; align-items: center; gap: 12px; }
    .wallet-btn {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 18px;
      background: transparent;
      border: 1px solid var(--gold);
      color: var(--gold);
      border-radius: var(--r);
      font-family: 'Syne', sans-serif;
      font-size: 0.8rem; font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .wallet-btn:hover { background: var(--gold); color: var(--bg0); }
    .wallet-btn.connected { background: rgba(31,168,110,0.15); border-color: var(--emerald); color: var(--emerald); }
    .wallet-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; animation: blink 2s infinite; }
    @keyframes blink { 0%, 100% { opacity:1; } 50% { opacity:0.3; } }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PAGE SECTIONS (Tab Panels)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .page { display: none; }
    .page.active { display: block; animation: fadeUp 0.3s ease; }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HERO
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hero {
      min-height: 52vh;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      text-align: center;
      padding: 5rem 2rem 3rem;
      position: relative;
      overflow: hidden;
    }
    .hero::before {
      content: '';
      position: absolute; inset: 0;
      background:
        radial-gradient(ellipse 60% 60% at 50% 50%, rgba(212,168,67,0.06) 0%, transparent 70%);
    }
    .hero-eyebrow {
      font-family: 'Syne Mono', monospace;
      font-size: 0.7rem; letter-spacing: 3px;
      color: var(--gold);
      text-transform: uppercase;
      margin-bottom: 1.2rem;
    }
    .hero-title {
      font-family: 'Instrument Serif', serif;
      font-size: clamp(3rem, 7vw, 5.5rem);
      line-height: 1.05;
      letter-spacing: -2px;
      margin-bottom: 1.2rem;
    }
    .hero-title em { font-style: italic; color: var(--gold); }
    .hero-sub {
      font-size: 1.05rem; color: var(--text1);
      max-width: 540px;
      margin-bottom: 2.5rem;
      line-height: 1.7;
    }
    .hero-chips {
      display: flex; flex-wrap: wrap; gap: 8px;
      justify-content: center;
      margin-bottom: 2.5rem;
    }
    .chip {
      font-size: 0.72rem; font-weight: 600;
      padding: 5px 13px;
      border-radius: 20px;
      border: 1px solid;
      display: flex; align-items: center; gap: 6px;
    }
    .chip-gold   { border-color: var(--gold3);   color: var(--gold);   background: rgba(212,168,67,0.08); }
    .chip-blue   { border-color: #1e5585;         color: var(--sapphire); background: rgba(45,127,202,0.08); }
    .chip-green  { border-color: #155c3d;         color: var(--emerald);  background: rgba(31,168,110,0.08); }
    .chip-violet { border-color: #4d2e88;         color: var(--violet);   background: rgba(124,77,204,0.08); }
    .chip-rose   { border-color: #7d2e57;         color: var(--rose);     background: rgba(201,77,138,0.08); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LAYOUT / CONTAINERS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .container { max-width: 1280px; margin: 0 auto; padding: 0 2.5rem; }
    .section { padding: 3rem 0; }
    .section-header {
      display: flex; align-items: baseline; gap: 16px;
      margin-bottom: 2rem;
    }
    .section-title {
      font-family: 'Instrument Serif', serif;
      font-size: 2rem;
      letter-spacing: -0.5px;
    }
    .section-sub {
      font-family: 'Syne Mono', monospace;
      font-size: 0.7rem; color: var(--text2);
      letter-spacing: 2px;
    }
    .divider { height: 1px; background: var(--line); margin: 2rem 0; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STATS BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .stats-bar {
      background: var(--bg1);
      border: 1px solid var(--line);
      border-radius: var(--r);
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 0;
      margin-bottom: 3rem;
      overflow: hidden;
    }
    .stat-cell {
      padding: 1.5rem 2rem;
      border-right: 1px solid var(--line);
      position: relative;
    }
    .stat-cell:last-child { border-right: none; }
    .stat-label {
      font-size: 0.7rem; font-weight: 600; letter-spacing: 1.5px;
      text-transform: uppercase; color: var(--text2);
      margin-bottom: 0.5rem;
    }
    .stat-value {
      font-family: 'Instrument Serif', serif;
      font-size: 2rem;
      letter-spacing: -0.5px;
    }
    .stat-value.gold   { color: var(--gold); }
    .stat-value.green  { color: var(--emerald); }
    .stat-value.blue   { color: var(--sapphire); }
    .stat-delta {
      font-size: 0.72rem; color: var(--text2);
      margin-top: 4px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NFT GRID
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .nft-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    .nft-card {
      background: var(--bg1);
      border: 1px solid var(--line);
      border-radius: 6px;
      overflow: hidden;
      transition: border-color 0.25s, transform 0.25s, box-shadow 0.25s;
      cursor: pointer;
      position: relative;
    }
    .nft-card:hover {
      border-color: var(--gold3);
      transform: translateY(-4px);
      box-shadow: 0 20px 50px rgba(0,0,0,0.5), 0 0 0 1px rgba(212,168,67,0.1);
    }
    .nft-card.rwa { border-color: rgba(31,168,110,0.3); }
    .nft-card.rwa:hover { border-color: var(--emerald); }
    .nft-card.auction { border-color: rgba(224,123,26,0.3); }
    .nft-card.auction:hover { border-color: var(--amber); }

    .card-art {
      width: 100%; aspect-ratio: 1;
      background: var(--bg2);
      position: relative;
      overflow: hidden;
    }
    .card-art canvas { width: 100%; height: 100%; }

    .card-badges {
      position: absolute; top: 12px; left: 12px;
      display: flex; gap: 6px; flex-wrap: wrap;
    }
    .badge {
      font-family: 'Syne Mono', monospace;
      font-size: 0.6rem; letter-spacing: 1px;
      padding: 3px 8px;
      border-radius: 2px;
      font-weight: 500;
      text-transform: uppercase;
    }
    .badge-rwa       { background: rgba(31,168,110,0.9);  color: #fff; }
    .badge-auth      { background: rgba(212,168,67,0.9);  color: #000; }
    .badge-auction   { background: rgba(224,123,26,0.9);  color: #fff; }
    .badge-redeemed  { background: rgba(122,127,154,0.9); color: #fff; }
    .badge-decaying  { background: rgba(204,58,58,0.9);   color: #fff; }
    .badge-waived    { background: rgba(124,77,204,0.9);  color: #fff; }
    .badge-pending   { background: rgba(45,127,202,0.9);  color: #fff; }

    .card-body { padding: 1.2rem 1.4rem; }
    .card-creator {
      font-size: 0.7rem; font-weight: 600; letter-spacing: 1px;
      color: var(--text2); text-transform: uppercase;
      margin-bottom: 4px;
    }
    .card-name {
      font-family: 'Instrument Serif', serif;
      font-size: 1.3rem; letter-spacing: -0.3px;
      margin-bottom: 0.7rem;
      line-height: 1.2;
    }

    .card-meta {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 0.7rem;
      margin-bottom: 1rem;
    }
    .meta-item { }
    .meta-label { font-size: 0.65rem; font-weight: 600; letter-spacing: 1px; color: var(--text3); text-transform: uppercase; margin-bottom: 2px; }
    .meta-value { font-family: 'Syne Mono', monospace; font-size: 0.82rem; color: var(--text1); }
    .meta-value.gold { color: var(--gold); }
    .meta-value.green { color: var(--emerald); }
    .meta-value.red { color: var(--crimson); }

    /* Auction countdown */
    .auction-bar {
      background: var(--bg2);
      border-top: 1px solid var(--line);
      padding: 10px 1.4rem;
      display: flex; align-items: center; justify-content: space-between;
    }
    .auction-label { font-size: 0.68rem; font-weight: 600; color: var(--amber); letter-spacing: 0.5px; }
    .auction-timer { font-family: 'Syne Mono', monospace; font-size: 0.82rem; color: var(--text0); }

    /* Royalty splits mini bar */
    .splits-bar {
      height: 4px;
      border-radius: 2px;
      overflow: hidden;
      display: flex;
      margin-bottom: 1rem;
    }
    .split-seg { height: 100%; transition: width 0.4s ease; }

    /* Card actions */
    .card-actions { display: flex; gap: 8px; }
    .btn {
      font-family: 'Syne', sans-serif;
      font-size: 0.78rem; font-weight: 700;
      padding: 9px 18px;
      border-radius: var(--r);
      border: none; cursor: pointer;
      transition: all 0.18s;
      letter-spacing: 0.3px;
    }
    .btn-primary {
      background: var(--gold);
      color: var(--bg0);
      flex: 1;
    }
    .btn-primary:hover { background: var(--gold2); }
    .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; }
    .btn-outline {
      background: transparent;
      border: 1px solid var(--line);
      color: var(--text1);
    }
    .btn-outline:hover { border-color: var(--text1); color: var(--text0); }
    .btn-ghost {
      background: transparent;
      color: var(--text2);
      font-size: 0.72rem; padding: 9px 12px;
    }
    .btn-ghost:hover { color: var(--text0); background: var(--bg3); }
    .btn-green { background: var(--emerald); color: #fff; flex: 1; }
    .btn-green:hover { filter: brightness(1.1); }
    .btn-amber { background: var(--amber); color: #fff; flex: 1; }
    .btn-amber:hover { filter: brightness(1.1); }
    .btn-violet { background: var(--violet); color: #fff; flex: 1; }
    .btn-violet:hover { filter: brightness(1.1); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FORMS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .form-grid { display: grid; gap: 1.2rem; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1.2rem; }
    .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; }
    .field { display: flex; flex-direction: column; gap: 6px; }
    .field label {
      font-size: 0.72rem; font-weight: 700;
      letter-spacing: 0.8px; text-transform: uppercase;
      color: var(--text2);
    }
    .field input, .field textarea, .field select {
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: var(--r);
      padding: 10px 14px;
      color: var(--text0);
      font-family: 'Syne Mono', monospace;
      font-size: 0.82rem;
      transition: border-color 0.2s;
      width: 100%;
    }
    .field input:focus, .field textarea:focus, .field select:focus {
      outline: none;
      border-color: var(--gold3);
    }
    .field textarea { min-height: 80px; resize: vertical; }
    .field select { appearance: none; cursor: pointer; }
    .field-hint { font-size: 0.68rem; color: var(--text3); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PANEL / CARD CONTAINERS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .panel {
      background: var(--bg1);
      border: 1px solid var(--line);
      border-radius: 6px;
      padding: 2rem;
    }
    .panel-header {
      font-family: 'Instrument Serif', serif;
      font-size: 1.4rem;
      margin-bottom: 1.5rem;
      display: flex; align-items: center; gap: 10px;
    }
    .panel-header .icon {
      font-size: 1.1rem;
      width: 34px; height: 34px;
      background: var(--bg3);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ROLE CARDS (Co-creator slots)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .role-slots { display: grid; gap: 1rem; margin-top: 1rem; }
    .role-slot {
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: 4px;
      padding: 1rem 1.2rem;
      display: grid;
      grid-template-columns: 36px 1fr auto auto;
      gap: 12px; align-items: center;
    }
    .role-icon {
      width: 36px; height: 36px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem;
    }
    .role-icon.athlete { background: rgba(212,168,67,0.15); color: var(--gold); }
    .role-icon.league  { background: rgba(45,127,202,0.15); color: var(--sapphire); }
    .role-icon.charity { background: rgba(31,168,110,0.15); color: var(--emerald); }
    .role-icon.media   { background: rgba(124,77,204,0.15); color: var(--violet); }
    .role-name { font-weight: 700; font-size: 0.82rem; }
    .role-addr { font-family: 'Syne Mono', monospace; font-size: 0.68rem; color: var(--text2); margin-top: 2px; }
    .role-share {
      font-family: 'Syne Mono', monospace;
      font-size: 0.88rem; font-weight: 600;
      color: var(--gold);
    }
    .role-status {
      font-size: 0.65rem; font-weight: 700; letter-spacing: 0.5px;
      padding: 3px 8px; border-radius: 2px;
    }
    .status-pending  { background: rgba(45,127,202,0.15); color: var(--sapphire); }
    .status-accepted { background: rgba(31,168,110,0.15); color: var(--emerald); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SPLIT VISUALIZER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .split-viz { margin-top: 1.5rem; }
    .split-row {
      display: flex; align-items: center; gap: 12px;
      margin-bottom: 10px;
    }
    .split-label {
      width: 120px; font-size: 0.72rem;
      font-weight: 600; color: var(--text1);
      flex-shrink: 0;
    }
    .split-track {
      flex: 1; height: 8px;
      background: var(--bg3);
      border-radius: 4px; overflow: hidden;
    }
    .split-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; }
    .split-pct {
      width: 45px; text-align: right;
      font-family: 'Syne Mono', monospace;
      font-size: 0.72rem; color: var(--text2);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ANALYTICS CHART
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .chart-wrap {
      background: var(--bg1);
      border: 1px solid var(--line);
      border-radius: 6px;
      padding: 1.5rem;
      position: relative;
    }
    .chart-title {
      font-size: 0.8rem; font-weight: 700;
      letter-spacing: 1px; text-transform: uppercase;
      color: var(--text2); margin-bottom: 1rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUCTION BID SECTION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .bid-section {
      background: rgba(224,123,26,0.06);
      border: 1px solid rgba(224,123,26,0.25);
      border-radius: 6px;
      padding: 1.5rem;
      margin-top: 1.5rem;
    }
    .bid-section h3 {
      font-family: 'Instrument Serif', serif;
      font-size: 1.2rem; color: var(--amber);
      margin-bottom: 1rem;
      display: flex; align-items: center; gap: 8px;
    }
    .bid-history {
      margin-top: 1rem;
      display: flex; flex-direction: column; gap: 8px;
    }
    .bid-row {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 12px;
      background: var(--bg2);
      border-radius: 4px;
      font-family: 'Syne Mono', monospace;
      font-size: 0.75rem;
    }
    .bid-row.winning { border-left: 3px solid var(--gold); }
    .bid-winner { color: var(--gold); }
    .bid-amount { color: var(--text0); font-weight: 600; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RWA PHYSICAL STATE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .physical-state {
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: 4px;
      padding: 1.2rem;
      margin-top: 1rem;
    }
    .physical-timeline {
      display: flex; gap: 0;
      margin-top: 1rem;
    }
    .timeline-step {
      flex: 1; text-align: center; position: relative;
    }
    .timeline-step::before {
      content: ''; position: absolute;
      top: 14px; left: 50%; right: -50%;
      height: 2px; background: var(--line);
    }
    .timeline-step:last-child::before { display: none; }
    .timeline-dot {
      width: 28px; height: 28px;
      border-radius: 50%;
      background: var(--bg3);
      border: 2px solid var(--line);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.75rem;
      margin: 0 auto 8px;
      position: relative; z-index: 1;
      transition: all 0.3s;
    }
    .timeline-dot.done { background: var(--emerald); border-color: var(--emerald); color: #fff; }
    .timeline-dot.current { background: var(--gold); border-color: var(--gold); color: var(--bg0); animation: gemPulse 2s infinite; }
    .timeline-label { font-size: 0.65rem; font-weight: 600; color: var(--text2); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NOTIFICATION TOAST
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .toast-container { position: fixed; bottom: 2rem; right: 2rem; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
    .toast {
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: 4px;
      padding: 14px 18px;
      min-width: 280px; max-width: 380px;
      box-shadow: var(--sh);
      animation: slideIn 0.3s ease;
      display: flex; align-items: flex-start; gap: 12px;
    }
    @keyframes slideIn {
      from { opacity:0; transform: translateX(20px); }
      to   { opacity:1; transform: translateX(0); }
    }
    .toast.success { border-left: 3px solid var(--emerald); }
    .toast.error   { border-left: 3px solid var(--crimson); }
    .toast.info    { border-left: 3px solid var(--sapphire); }
    .toast.warning { border-left: 3px solid var(--amber); }
    .toast-icon { font-size: 1rem; margin-top: 2px; }
    .toast-body { flex: 1; }
    .toast-title { font-size: 0.82rem; font-weight: 700; margin-bottom: 2px; }
    .toast-msg { font-size: 0.75rem; color: var(--text1); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(4px);
      z-index: 500;
      display: flex; align-items: center; justify-content: center;
      padding: 2rem;
    }
    .modal {
      background: var(--bg1);
      border: 1px solid var(--line);
      border-radius: 8px;
      width: 100%; max-width: 600px;
      max-height: 90vh; overflow-y: auto;
      padding: 2rem;
      position: relative;
      animation: fadeUp 0.25s ease;
    }
    .modal-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 1.5rem;
    }
    .modal-title {
      font-family: 'Instrument Serif', serif;
      font-size: 1.6rem; letter-spacing: -0.3px;
    }
    .modal-close {
      background: var(--bg3); border: none;
      color: var(--text2); border-radius: 4px;
      width: 32px; height: 32px;
      cursor: pointer; font-size: 1.1rem;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .modal-close:hover { background: var(--bg4); color: var(--text0); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WALLET SELECTOR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .wallet-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
    .wallet-option {
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: 6px;
      padding: 1.2rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    .wallet-option:hover { border-color: var(--gold3); background: var(--bg3); }
    .wallet-logo { font-size: 2rem; margin-bottom: 8px; }
    .wallet-name { font-size: 0.85rem; font-weight: 700; }
    .wallet-desc { font-size: 0.68rem; color: var(--text2); margin-top: 4px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CREATOR PROFILE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .creator-profile {
      display: flex; gap: 2rem; align-items: flex-start;
      margin-bottom: 2.5rem;
    }
    .creator-avatar {
      width: 80px; height: 80px;
      border-radius: 50%;
      border: 2px solid var(--gold3);
      flex-shrink: 0;
      overflow: hidden;
    }
    .creator-info { flex: 1; }
    .creator-name {
      font-family: 'Instrument Serif', serif;
      font-size: 2rem; letter-spacing: -0.5px;
      display: flex; align-items: center; gap: 10px;
    }
    .verified-badge {
      display: inline-flex; align-items: center;
      background: linear-gradient(135deg, var(--gold3), var(--gold));
      color: var(--bg0); border-radius: 20px;
      padding: 2px 10px;
      font-size: 0.68rem; font-weight: 800;
      letter-spacing: 1px; font-family: 'Syne', sans-serif;
    }
    .creator-addr { font-family: 'Syne Mono', monospace; font-size: 0.75rem; color: var(--text2); margin-top: 4px; }
    .creator-stats { display: flex; gap: 2rem; margin-top: 1rem; }
    .creator-stat { }
    .creator-stat-val { font-family: 'Instrument Serif', serif; font-size: 1.4rem; color: var(--gold); }
    .creator-stat-lbl { font-size: 0.68rem; font-weight: 600; letter-spacing: 1px; color: var(--text2); text-transform: uppercase; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BATCH MINT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .batch-item {
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: 4px;
      padding: 1rem 1.2rem;
      margin-bottom: 0.8rem;
      display: flex; align-items: center; gap: 12px;
    }
    .batch-num {
      width: 28px; height: 28px;
      background: var(--bg3);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Syne Mono', monospace;
      font-size: 0.75rem; color: var(--text2);
      flex-shrink: 0;
    }
    .batch-info { flex: 1; }
    .batch-name { font-size: 0.85rem; font-weight: 700; }
    .batch-meta { font-family: 'Syne Mono', monospace; font-size: 0.7rem; color: var(--text2); }
    .batch-remove {
      background: none; border: none; color: var(--text3); cursor: pointer;
      font-size: 1rem; padding: 4px;
      border-radius: 4px; transition: color 0.2s;
    }
    .batch-remove:hover { color: var(--crimson); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DECAY CHART INDICATOR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .decay-indicator {
      display: flex; align-items: center; gap: 12px;
      background: var(--bg2); border-radius: 4px;
      padding: 12px 16px; margin-top: 1rem;
    }
    .decay-track {
      flex: 1; height: 6px;
      background: var(--bg3); border-radius: 3px; overflow: hidden;
    }
    .decay-fill {
      height: 100%; border-radius: 3px;
      background: linear-gradient(90deg, var(--gold), var(--crimson));
      transition: width 0.5s;
    }
    .decay-info { font-family: 'Syne Mono', monospace; font-size: 0.72rem; color: var(--text2); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TABS within sections
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .inner-tabs { display: flex; gap: 4px; border-bottom: 1px solid var(--line); margin-bottom: 2rem; }
    .inner-tab {
      padding: 10px 18px;
      font-size: 0.78rem; font-weight: 600;
      color: var(--text2); cursor: pointer;
      border: none; background: none;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      transition: all 0.2s;
    }
    .inner-tab:hover { color: var(--text0); }
    .inner-tab.active { color: var(--gold); border-bottom-color: var(--gold); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width: 900px) {
      .stats-bar { grid-template-columns: repeat(2,1fr); }
      .form-row, .form-row-3 { grid-template-columns: 1fr; }
    }
    @media (max-width: 650px) {
      nav { padding: 0 1rem; }
      .container { padding: 0 1rem; }
      .nav-tabs { display: none; }
      .stats-bar { grid-template-columns: 1fr; }
      .creator-profile { flex-direction: column; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GENERATIVE ART (Canvas placeholder art)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .art-canvas { width: 100%; height: 100%; display: block; }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav>
  <div class="nav-brand">
    <div class="nav-gem">M</div>
    Muse
    <span class="nav-badge">v2 Â· ALGORAND</span>
  </div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showPage('marketplace')">Marketplace</button>
    <button class="nav-tab" onclick="showPage('mint')">Mint</button>
    <button class="nav-tab" onclick="showPage('rwa')">RWA</button>
    <button class="nav-tab" onclick="showPage('analytics')">Analytics</button>
    <button class="nav-tab" onclick="showPage('profile')">Profile</button>
  </div>
  <div class="nav-right">
    <button class="wallet-btn" id="walletBtn" onclick="showWalletModal()">
      <span>Connect Wallet</span>
    </button>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE: MARKETPLACE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="page-marketplace">
  <!-- Hero -->
  <div class="hero">
    <div class="hero-eyebrow">Algorand Â· ARC-69 Â· Testnet</div>
    <h1 class="hero-title">Own the <em>moment.</em><br/>Own the <em>memory.</em></h1>
    <p class="hero-sub">The only marketplace with on-chain fractional royalties, time-decaying splits, RWA physical tethering, and live auctions â€” all enforced by smart contract.</p>
    <div class="hero-chips">
      <span class="chip chip-gold">â§« Time-Decaying Royalties</span>
      <span class="chip chip-blue">âŠ• 4-Way Splits</span>
      <span class="chip chip-green">â¬¡ Physical Asset RWA</span>
      <span class="chip chip-violet">â§‰ Auction &amp; Bidding</span>
      <span class="chip chip-rose">âŠ Royalty Buy-Out</span>
    </div>
    <div style="display:flex;gap:12px;">
      <button class="btn btn-primary" onclick="showPage('mint')" style="padding:12px 28px;font-size:0.92rem;">Mint NFT</button>
      <button class="btn btn-outline" onclick="showPage('rwa')" style="padding:12px 28px;font-size:0.92rem;">List RWA</button>
    </div>
  </div>

  <div class="container">
    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat-cell">
        <div class="stat-label">Total Volume</div>
        <div class="stat-value gold" id="stat-volume">4,218 Èº</div>
        <div class="stat-delta">â†‘ +12.4% this week</div>
      </div>
      <div class="stat-cell">
        <div class="stat-label">NFTs Minted</div>
        <div class="stat-value" id="stat-minted">1,847</div>
        <div class="stat-delta">Incl. 214 RWA tethered</div>
      </div>
      <div class="stat-cell">
        <div class="stat-label">Royalties Paid</div>
        <div class="stat-value green" id="stat-royalties">318 Èº</div>
        <div class="stat-delta">Across 2,901 transfers</div>
      </div>
      <div class="stat-cell">
        <div class="stat-label">Live Auctions</div>
        <div class="stat-value blue" id="stat-auctions">7</div>
        <div class="stat-delta">Highest bid: 420 Èº</div>
      </div>
    </div>

    <!-- Filter Bar -->
    <div style="display:flex;gap:8px;margin-bottom:2rem;flex-wrap:wrap;">
      <button class="btn btn-primary" onclick="filterCards('all')" id="f-all">All</button>
      <button class="btn btn-ghost" onclick="filterCards('digital')" id="f-digital">Digital NFT</button>
      <button class="btn btn-ghost" onclick="filterCards('rwa')" id="f-rwa">â¬¡ RWA</button>
      <button class="btn btn-ghost" onclick="filterCards('auction')" id="f-auction">â§‰ Auctions</button>
      <button class="btn btn-ghost" onclick="filterCards('waived')" id="f-waived">âŠ Royalty-Free</button>
    </div>

    <!-- NFT Grid -->
    <div class="nft-grid" id="nft-grid">
      <!-- Cards injected by JS -->
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE: MINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-mint">
  <div class="container section">
    <div class="section-header">
      <h2 class="section-title">Create &amp; Mint</h2>
      <span class="section-sub">ARC-69 COMPLIANT</span>
    </div>

    <div class="inner-tabs">
      <button class="inner-tab active" onclick="showMintTab('single')">Single NFT</button>
      <button class="inner-tab" onclick="showMintTab('batch')">Batch Mint</button>
      <button class="inner-tab" onclick="showMintTab('collab')">Collaboration</button>
    </div>

    <!-- Single Mint -->
    <div id="mint-single">
      <div style="display:grid;grid-template-columns:1.2fr 1fr;gap:2.5rem;">
        <div>
          <div class="panel">
            <div class="panel-header"><div class="icon">ğŸ¨</div> NFT Details</div>
            <div class="form-grid">
              <div class="form-row">
                <div class="field">
                  <label>NFT Name</label>
                  <input type="text" id="m-name" placeholder="e.g. Dreamscape #001" oninput="updateMintPreview()"/>
                </div>
                <div class="field">
                  <label>Unit Symbol</label>
                  <input type="text" id="m-unit" placeholder="e.g. DREAM" maxlength="8" oninput="updateMintPreview()"/>
                </div>
              </div>
              <div class="field">
                <label>ARC-69 Metadata JSON</label>
                <textarea id="m-metadata" placeholder='{"standard":"arc69","description":"","mime_type":"image/png","properties":{}}'></textarea>
                <span class="field-hint">Full ARC-69 standard metadata for Algorand explorer compatibility.</span>
              </div>
              <div class="field">
                <label>Metadata Hash (SHA-256)</label>
                <input type="text" id="m-hash" placeholder="0x... (hash of full metadata file)"/>
              </div>
              <div class="form-row">
                <div class="field">
                  <label>List Price (Èº)</label>
                  <input type="number" id="m-price" placeholder="10" min="0.1" step="0.1" oninput="updateMintPreview()"/>
                </div>
                <div class="field">
                  <label>Royalty % (max 20%)</label>
                  <input type="range" id="m-royalty" min="0" max="20" value="10" step="0.5" oninput="updateMintPreview()" style="padding:0;background:none;border:none;cursor:pointer;height:auto;margin-top:10px;"/>
                  <span style="font-family:'Syne Mono',monospace;font-size:0.8rem;color:var(--gold)" id="m-royalty-val">10%</span>
                </div>
              </div>

              <!-- Time-Decay Section -->
              <div style="background:var(--bg2);border:1px solid var(--line);border-radius:4px;padding:1.2rem;">
                <div style="font-size:0.78rem;font-weight:700;color:var(--text1);margin-bottom:12px;display:flex;align-items:center;gap:8px;">
                  â± Time-Decaying Royalties <span style="font-size:0.65rem;background:rgba(212,168,67,0.1);border:1px solid var(--gold3);color:var(--gold);padding:2px 7px;border-radius:10px;">OPTIONAL</span>
                </div>
                <div class="form-row">
                  <div class="field">
                    <label>Decay After (rounds)</label>
                    <input type="number" id="m-decay" placeholder="0 = no decay" min="0" oninput="updateMintPreview()"/>
                    <span class="field-hint">~4s per round. 180 days â‰ˆ 3,888,000 rounds</span>
                  </div>
                  <div class="field">
                    <label>Floor Royalty % after decay</label>
                    <input type="number" id="m-floor" placeholder="5" min="0" max="20" step="0.5" oninput="updateMintPreview()"/>
                  </div>
                </div>
                <div class="decay-indicator" id="decay-indicator">
                  <span style="font-size:0.72rem;color:var(--text2);font-weight:600;flex-shrink:0;">Royalty over time</span>
                  <div class="decay-track"><div class="decay-fill" id="decay-fill" style="width:100%;"></div></div>
                  <div class="decay-info" id="decay-info">10% â†’ no decay</div>
                </div>
              </div>

              <!-- Buy-Out -->
              <div class="field">
                <label>Royalty Buy-Out Price (Èº) <span style="color:var(--text3);font-size:0.65rem;">0 = disabled</span></label>
                <input type="number" id="m-buyout" placeholder="0" min="0" oninput="updateMintPreview()"/>
                <span class="field-hint">One-time fee a buyer can pay to permanently remove royalties from this NFT.</span>
              </div>

              <button class="btn btn-primary" style="font-size:0.9rem;padding:12px;" onclick="mintSingleNFT()">
                â¬¡ Mint NFT on Algorand
              </button>
            </div>
          </div>
        </div>

        <!-- Live Preview -->
        <div>
          <div class="panel">
            <div class="panel-header"><div class="icon">ğŸ‘</div> Live Preview</div>
            <div style="background:var(--bg2);border-radius:4px;overflow:hidden;margin-bottom:1.2rem;aspect-ratio:1;">
              <canvas id="preview-canvas" class="art-canvas"></canvas>
            </div>
            <div style="margin-bottom:1rem;">
              <div style="font-family:'Instrument Serif',serif;font-size:1.4rem;letter-spacing:-0.3px;" id="prev-name">NFT Name</div>
              <div style="font-family:'Syne Mono',monospace;font-size:0.7rem;color:var(--text2);margin-top:4px;" id="prev-unit">UNIT</div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.7rem;margin-bottom:1.2rem;">
              <div class="meta-item"><div class="meta-label">List Price</div><div class="meta-value gold" id="prev-price">â€” Èº</div></div>
              <div class="meta-item"><div class="meta-label">Royalty</div><div class="meta-value" id="prev-royalty">â€”%</div></div>
              <div class="meta-item"><div class="meta-label">Floor Royalty</div><div class="meta-value" id="prev-floor">â€”</div></div>
              <div class="meta-item"><div class="meta-label">Buy-Out Price</div><div class="meta-value" id="prev-buyout">â€”</div></div>
            </div>
            <div style="font-size:0.72rem;font-weight:700;color:var(--text2);letter-spacing:0.8px;text-transform:uppercase;margin-bottom:8px;">Estimated Split on Sale</div>
            <div class="split-viz" id="prev-split-viz"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Batch Mint -->
    <div id="mint-batch" style="display:none;">
      <div class="panel">
        <div class="panel-header"><div class="icon">ğŸ“¦</div> Batch Mint Queue</div>
        <p style="font-size:0.82rem;color:var(--text1);margin-bottom:1.5rem;">Add multiple NFTs to mint in a single transaction sequence. Reduces network fees and manual effort for large collections.</p>
        <div id="batch-list"></div>
        <div style="background:var(--bg2);border:1px dashed var(--line);border-radius:4px;padding:1.2rem;margin-bottom:1.2rem;">
          <div class="form-row-3">
            <div class="field">
              <label>Name</label>
              <input type="text" id="b-name" placeholder="Collection #001"/>
            </div>
            <div class="field">
              <label>Price (Èº)</label>
              <input type="number" id="b-price" placeholder="10" min="0.1"/>
            </div>
            <div class="field">
              <label>Royalty %</label>
              <input type="number" id="b-royalty" placeholder="10" min="0" max="20"/>
            </div>
          </div>
          <button class="btn btn-outline" style="margin-top:1rem;" onclick="addBatchItem()">+ Add to Queue</button>
        </div>
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <div style="font-size:0.8rem;color:var(--text2);">Queue: <span id="batch-count" style="color:var(--gold);font-weight:700;font-family:'Syne Mono',monospace;">0 items</span></div>
          <button class="btn btn-primary" onclick="executeBatchMint()">â¬¡ Execute Batch Mint</button>
        </div>
      </div>
    </div>

    <!-- Collaboration -->
    <div id="mint-collab" style="display:none;">
      <div class="panel">
        <div class="panel-header"><div class="icon">ğŸ¤</div> Collaboration &amp; Co-Creator Setup</div>
        <p style="font-size:0.82rem;color:var(--text1);margin-bottom:1.5rem;">
          Register up to 4 co-creators with role labels and royalty shares. Each co-creator must <strong>call accept_collaboration()</strong> on-chain to formally consent to their role â€” preventing unauthorized registrations.
        </p>
        <div class="form-row" style="margin-bottom:1.5rem;">
          <div class="field">
            <label>NFT Name</label>
            <input type="text" id="co-name" placeholder="Collaborative Piece"/>
          </div>
          <div class="field">
            <label>Total Royalty %</label>
            <input type="number" id="co-royalty" placeholder="10" min="0" max="20" oninput="updateCollabSplits()"/>
          </div>
        </div>
        <div class="role-slots" id="collab-slots">
          <!-- injected by JS -->
        </div>
        <div style="margin-top:1.5rem;padding:1rem;background:var(--bg2);border-radius:4px;">
          <div style="font-size:0.72rem;font-weight:700;color:var(--text2);letter-spacing:1px;text-transform:uppercase;margin-bottom:8px;">Total Share Allocation</div>
          <div style="display:flex;align-items:center;gap:12px;">
            <div class="split-track" style="flex:1;"><div class="split-fill" id="collab-total-bar" style="width:0%;background:var(--gold);"></div></div>
            <div style="font-family:'Syne Mono',monospace;font-size:0.82rem;" id="collab-total-pct">0 / 100%</div>
          </div>
        </div>
        <div style="margin-top:1.5rem;display:flex;gap:10px;">
          <button class="btn btn-primary" onclick="mintCollab()">â¬¡ Mint with Co-Creators</button>
          <button class="btn btn-ghost" onclick="simulateAcceptance()">â–¶ Simulate Co-Creator Acceptance</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE: RWA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-rwa">
  <div class="container section">
    <div class="section-header">
      <h2 class="section-title">Real World Assets</h2>
      <span class="section-sub">PHYSICAL TETHERING</span>
    </div>
    <p style="font-size:0.9rem;color:var(--text1);max-width:680px;margin-bottom:2.5rem;line-height:1.7;">
      Tokenize physical items â€” athlete memorabilia, signed collectibles, artwork, or luxury goods. Each RWA is linked to a physical item via a cryptographic hash of its certificate of authenticity. Listings remain inactive until a certified authenticator validates the item on-chain.
    </p>

    <div style="display:grid;grid-template-columns:1.3fr 1fr;gap:2.5rem;">
      <!-- Form -->
      <div>
        <div class="panel">
          <div class="panel-header"><div class="icon">â¬¡</div> Mint RWA Token</div>
          <div class="form-grid">
            <div class="form-row">
              <div class="field">
                <label>Item Name</label>
                <input type="text" id="r-name" placeholder="LeBron Game-Worn Jersey #23"/>
              </div>
              <div class="field">
                <label>Unit Symbol</label>
                <input type="text" id="r-unit" placeholder="LBGRWJ"/>
              </div>
            </div>
            <div class="field">
              <label>ARC-69 Metadata JSON</label>
              <textarea id="r-metadata" placeholder='{"standard":"arc69","description":"Game-worn jersey from 2024 NBA Finals Game 7","mime_type":"image/jpeg","properties":{"athlete":"LeBron James","event":"NBA Finals 2024","item_type":"jersey","size":"XL"}}'></textarea>
            </div>
            <div class="field">
              <label>Physical Asset Hash (SHA-256 of CoA / NFC / Photo)</label>
              <input type="text" id="r-phash" placeholder="sha256:abcdef1234... (hash of certificate of authenticity)"/>
              <span class="field-hint">This irreversibly links the token to the specific physical item's documentation.</span>
            </div>
            <div class="form-row">
              <div class="field">
                <label>Custodian Address (Vault)</label>
                <input type="text" id="r-custodian" placeholder="ALGO address of vault/custodian"/>
              </div>
              <div class="field">
                <label>Authenticator Address</label>
                <input type="text" id="r-auth" placeholder="ALGO address of authenticator"/>
              </div>
            </div>
            <div class="form-row">
              <div class="field">
                <label>List Price (Èº)</label>
                <input type="number" id="r-price" placeholder="1000" min="1"/>
              </div>
              <div class="field">
                <label>Royalty % (max 20%)</label>
                <input type="number" id="r-royalty" placeholder="10" min="0" max="20"/>
              </div>
            </div>
            <div class="field">
              <label>Royalty Buy-Out Price (Èº) <span style="color:var(--text3)">0 = disabled</span></label>
              <input type="number" id="r-buyout" placeholder="0"/>
            </div>

            <!-- Multi-layer royalty splits -->
            <div style="background:var(--bg2);border:1px solid var(--line);border-radius:4px;padding:1.2rem;">
              <div style="font-size:0.78rem;font-weight:700;color:var(--text1);margin-bottom:1rem;">
                ğŸ† Multi-Layer Royalty Splits (NBA Player Model)
              </div>
              <div id="rwa-role-slots"></div>
              <div style="font-size:0.7rem;color:var(--text3);margin-top:8px;">
                Remaining royalty % goes to primary creator/athlete (slot 1). Slots 2â€“4 are optional.
              </div>
            </div>

            <button class="btn btn-green" style="font-size:0.9rem;padding:12px;" onclick="mintRWA()">
              â¬¡ Mint RWA Token (Pending Authentication)
            </button>
          </div>
        </div>
      </div>

      <!-- RWA Lifecycle -->
      <div>
        <div class="panel" style="margin-bottom:1.5rem;">
          <div class="panel-header"><div class="icon">ğŸ”</div> Authentication &amp; Redemption</div>
          <p style="font-size:0.78rem;color:var(--text1);margin-bottom:1.5rem;">
            Track a live RWA through its full lifecycle: from minting to authentication, sale, and physical redemption.
          </p>

          <div class="field" style="margin-bottom:1rem;">
            <label>Contract / NFT ID to Check</label>
            <input type="text" id="rwa-check-id" placeholder="App ID or NFT ID"/>
          </div>

          <!-- State Machine Visualization -->
          <div class="physical-state" id="rwa-state-viz">
            <div style="font-size:0.72rem;font-weight:700;color:var(--text2);letter-spacing:1px;margin-bottom:1rem;text-transform:uppercase;">Physical Item Lifecycle</div>
            <div class="physical-timeline">
              <div class="timeline-step">
                <div class="timeline-dot done" id="tl-minted">âœ“</div>
                <div class="timeline-label">Minted</div>
              </div>
              <div class="timeline-step">
                <div class="timeline-dot current" id="tl-auth">â³</div>
                <div class="timeline-label">Authenticated</div>
              </div>
              <div class="timeline-step">
                <div class="timeline-dot" id="tl-listed">â—¯</div>
                <div class="timeline-label">Listed</div>
              </div>
              <div class="timeline-step">
                <div class="timeline-dot" id="tl-sold">â—¯</div>
                <div class="timeline-label">Sold</div>
              </div>
              <div class="timeline-step">
                <div class="timeline-dot" id="tl-redeemed">â—¯</div>
                <div class="timeline-label">Redeemed</div>
              </div>
            </div>
          </div>

          <div style="display:grid;gap:8px;margin-top:1.2rem;">
            <button class="btn btn-green" onclick="simulateAuthenticate()">ğŸ” Authenticate (as Authenticator)</button>
            <button class="btn btn-amber" onclick="simulateRedeem()">ğŸ“¦ Redeem Physical Item (as Custodian)</button>
            <button class="btn btn-violet" onclick="simulateStartAuction()">â§‰ Start Auction for this RWA</button>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header"><div class="icon">â§‰</div> Live Auction</div>
          <div class="bid-section" id="rwa-auction">
            <h3>â§‰ Active Auction</h3>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem;">
              <div class="meta-item"><div class="meta-label">Ends In</div><div class="meta-value gold" id="auction-timer">â€”</div></div>
              <div class="meta-item"><div class="meta-label">Highest Bid</div><div class="meta-value" id="auction-high">â€”</div></div>
            </div>
            <div class="bid-history" id="bid-history-list"></div>
            <div style="display:flex;gap:8px;margin-top:1rem;">
              <div class="field" style="flex:1;margin:0;">
                <input type="number" id="bid-amount" placeholder="Enter bid in Èº" style="margin:0;"/>
              </div>
              <button class="btn btn-amber" onclick="placeBid()">Place Bid</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE: ANALYTICS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-analytics">
  <div class="container section">
    <div class="section-header">
      <h2 class="section-title">Analytics Dashboard</h2>
      <span class="section-sub">REAL-TIME STATS</span>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:1.5rem;">
      <div class="chart-wrap">
        <div class="chart-title">Volume Over Time (Èº)</div>
        <canvas id="chart-volume" height="200"></canvas>
      </div>
      <div class="chart-wrap">
        <div class="chart-title">Sales by Category</div>
        <canvas id="chart-category" height="200"></canvas>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:1.5rem;">
      <div class="chart-wrap">
        <div class="chart-title">Royalty Decay Simulation</div>
        <canvas id="chart-decay" height="200"></canvas>
      </div>
      <div class="chart-wrap">
        <div class="chart-title">Top Artists by Volume</div>
        <canvas id="chart-artists" height="200"></canvas>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header"><div class="icon">âš™</div> Royalty Decay Calculator</div>
      <p style="font-size:0.8rem;color:var(--text1);margin-bottom:1.2rem;">
        Simulate how time-decaying royalties will behave for any NFT configuration.
      </p>
      <div class="form-row-3">
        <div class="field">
          <label>Initial Royalty %</label>
          <input type="number" id="calc-init" value="10" min="0" max="20" oninput="updateDecayCalc()"/>
        </div>
        <div class="field">
          <label>Floor Royalty %</label>
          <input type="number" id="calc-floor" value="5" min="0" max="20" oninput="updateDecayCalc()"/>
        </div>
        <div class="field">
          <label>Decay After (months)</label>
          <input type="number" id="calc-months" value="12" min="1" oninput="updateDecayCalc()"/>
        </div>
      </div>
      <div style="margin-top:1rem;font-family:'Syne Mono',monospace;font-size:0.78rem;color:var(--text1);background:var(--bg2);padding:12px 16px;border-radius:4px;" id="decay-calc-output">
        â€” Enter values above to simulate â€”
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE: PROFILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-profile">
  <div class="container section">
    <div class="creator-profile">
      <canvas id="avatar-canvas" class="creator-avatar" width="80" height="80"></canvas>
      <div class="creator-info">
        <div class="creator-name">
          Creative Studio 808
          <span class="verified-badge">âœ“ VERIFIED</span>
        </div>
        <div class="creator-addr" id="profile-addr">Not connected â€” connect wallet to view profile</div>
        <div class="creator-stats">
          <div class="creator-stat">
            <div class="creator-stat-val">34</div>
            <div class="creator-stat-lbl">NFTs Created</div>
          </div>
          <div class="creator-stat">
            <div class="creator-stat-val">892 Èº</div>
            <div class="creator-stat-lbl">Total Volume</div>
          </div>
          <div class="creator-stat">
            <div class="creator-stat-val">67 Èº</div>
            <div class="creator-stat-lbl">Royalties Earned</div>
          </div>
          <div class="creator-stat">
            <div class="creator-stat-val">4</div>
            <div class="creator-stat-lbl">RWA Listed</div>
          </div>
        </div>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;">
      <div class="panel">
        <div class="panel-header"><div class="icon">ğŸ”‘</div> Pending Collaboration Invites</div>
        <p style="font-size:0.78rem;color:var(--text1);margin-bottom:1.2rem;">
          Co-creator invitations awaiting your on-chain acceptance. Click Accept to sign a transaction confirming your role and royalty share.
        </p>
        <div id="collab-invites"></div>
      </div>
      <div class="panel">
        <div class="panel-header"><div class="icon">âŠ</div> Royalty Buy-Out Offers</div>
        <p style="font-size:0.78rem;color:var(--text1);margin-bottom:1.2rem;">
          Buyers can pay a one-time premium to permanently remove royalties from specific NFTs. Review and respond to offers here.
        </p>
        <div id="buyout-offers"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     WALLET MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="wallet-modal" style="display:none;" onclick="closeWalletModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title">Connect Wallet</div>
      <button class="modal-close" onclick="closeWalletModal()">âœ•</button>
    </div>
    <p style="font-size:0.82rem;color:var(--text1);margin-bottom:1.5rem;">
      Connect your Algorand wallet to mint, buy, bid, and manage your NFTs. Multi-wallet support via WalletConnect and native adapters.
    </p>
    <div class="wallet-grid">
      <div class="wallet-option" onclick="connectWallet('pera')">
        <div class="wallet-logo">ğŸŸ¢</div>
        <div class="wallet-name">Pera Wallet</div>
        <div class="wallet-desc">Official Algorand mobile wallet</div>
      </div>
      <div class="wallet-option" onclick="connectWallet('defly')">
        <div class="wallet-logo">ğŸ”µ</div>
        <div class="wallet-name">Defly</div>
        <div class="wallet-desc">DeFi-focused Algorand wallet</div>
      </div>
      <div class="wallet-option" onclick="connectWallet('kibisis')">
        <div class="wallet-logo">âš¡</div>
        <div class="wallet-name">Kibisis</div>
        <div class="wallet-desc">Browser extension wallet</div>
      </div>
      <div class="wallet-option" onclick="connectWallet('walletconnect')">
        <div class="wallet-logo">ğŸ”—</div>
        <div class="wallet-name">WalletConnect</div>
        <div class="wallet-desc">Connect any compatible wallet</div>
      </div>
    </div>
  </div>
</div>

<!-- Detail Modal -->
<div class="modal-overlay" id="detail-modal" style="display:none;" onclick="closeDetailModal(event)">
  <div class="modal" onclick="event.stopPropagation()" style="max-width:700px;">
    <div class="modal-header">
      <div class="modal-title" id="dm-title">NFT Details</div>
      <button class="modal-close" onclick="closeDetailModal()">âœ•</button>
    </div>
    <div id="dm-body"></div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toasts"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€ STATE â”€â”€
let walletConnected = false;
let walletAddress = '';
let walletProvider = '';
let batchItems = [];
let auctionBids = [];
let auctionEndTime = null;
let auctionInterval = null;

const SAMPLE_NFTS = [
  {
    id: 1, name: "Solstice Bloom #07", creator: "Studio Meridian", unit: "SLST7",
    price: 24, royalty: 10, floor: 5, decayMonths: 12, buyout: 500,
    transfers: 3, type: "digital", waived: false, auction: false,
    colors: ['#d4a843','#a07820','#2d7fca'],
    splits: [{label:'Creator',pct:40,color:'#d4a843'},{label:'Collab',pct:30,color:'#2d7fca'},{label:'Charity',pct:20,color:'#1fa86e'},{label:'Muse',pct:10,color:'#7c4dcc'}]
  },
  {
    id: 2, name: "Finals Game 7 Jersey", creator: "Sports Vault Auth.", unit: "FG7J",
    price: 4200, royalty: 12, floor: 8, decayMonths: 0, buyout: 80000,
    transfers: 1, type: "rwa", waived: false, auction: false,
    isAuth: true, isRedeemed: false,
    colors: ['#1fa86e','#155c3d','#d4a843'],
    splits: [{label:'Athlete',pct:50,color:'#d4a843'},{label:'NBA',pct:25,color:'#2d7fca'},{label:'Charity',pct:15,color:'#1fa86e'},{label:'Media',pct:7,color:'#7c4dcc'},{label:'Muse',pct:3,color:'#4a4e65'}]
  },
  {
    id: 3, name: "Neon Glitch Series #3", creator: "Pixel Anarchy", unit: "NGS3",
    price: 8, royalty: 7.5, floor: 0, decayMonths: 0, buyout: 0,
    transfers: 12, type: "digital", waived: true, auction: false,
    colors: ['#c94d8a','#7c4dcc','#2d7fca'],
    splits: [{label:'Creator',pct:87.5,color:'#c94d8a'},{label:'Muse',pct:12.5,color:'#4a4e65'}]
  },
  {
    id: 4, name: "Championship Ring", creator: "Ring Bearer LLC", unit: "CHAMP",
    price: 0, royalty: 15, floor: 10, decayMonths: 24, buyout: 200000,
    transfers: 0, type: "rwa", waived: false, auction: true,
    isAuth: true, isRedeemed: false,
    highBid: 12000,
    colors: ['#d4a843','#f0c96a','#cc3a3a'],
    splits: [{label:'Athlete',pct:40,color:'#d4a843'},{label:'League',pct:30,color:'#2d7fca'},{label:'Charity',pct:20,color:'#1fa86e'},{label:'Muse',pct:10,color:'#4a4e65'}]
  },
  {
    id: 5, name: "Abstract Void #22", creator: "Void.art", unit: "VOID",
    price: 3.5, royalty: 5, floor: 5, decayMonths: 0, buyout: 0,
    transfers: 28, type: "digital", waived: false, auction: false,
    colors: ['#08090d','#262b3a','#2d7fca'],
    splits: [{label:'Creator',pct:95,color:'#2d7fca'},{label:'Muse',pct:5,color:'#4a4e65'}]
  },
  {
    id: 6, name: "Signed Baseball '84 WS", creator: "Heritage Auth.", unit: "SB84",
    price: 850, royalty: 10, floor: 5, decayMonths: 18, buyout: 15000,
    transfers: 4, type: "rwa", waived: false, auction: false,
    isAuth: false, isRedeemed: false,
    colors: ['#e07b1a','#a07820','#d4a843'],
    splits: [{label:'Athlete',pct:60,color:'#d4a843'},{label:'Heritage',pct:25,color:'#e07b1a'},{label:'Charity',pct:10,color:'#1fa86e'},{label:'Muse',pct:5,color:'#4a4e65'}]
  },
];

const COLLAB_ROLES = [
  { key:'athlete', icon:'ğŸ†', label:'Athlete / Primary', color:'--athlete', cls:'athlete' },
  { key:'league',  icon:'ğŸ›', label:'Team / League',     color:'--league',  cls:'league'  },
  { key:'charity', icon:'ğŸ’š', label:'Charity',           color:'--charity', cls:'charity'  },
  { key:'media',   icon:'ğŸ“¸', label:'Photographer / Media', color:'--media', cls:'media'  },
];

// â”€â”€ PAGE NAV â”€â”€
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  event && event.currentTarget && event.currentTarget.classList.add('active');
  // Find nav tab
  document.querySelectorAll('.nav-tab').forEach(t => {
    if(t.textContent.toLowerCase().includes(name.toLowerCase().replace('marketplace','market'))) t.classList.add('active');
  });
  if(name === 'analytics') initCharts();
  if(name === 'mint') {
    initCollabSlots();
    initRWARoleSlots();
    drawPreviewCanvas();
  }
  if(name === 'rwa') {
    initRWARoleSlots();
    initRWAAuction();
  }
  if(name === 'profile') {
    initProfile();
  }
}

// â”€â”€ WALLET â”€â”€
function showWalletModal() {
  document.getElementById('wallet-modal').style.display = 'flex';
}
function closeWalletModal(e) {
  if(!e || e.target === document.getElementById('wallet-modal'))
    document.getElementById('wallet-modal').style.display = 'none';
}
function connectWallet(provider) {
  walletProvider = provider;
  walletAddress = 'MUSE' + randomHex(6).toUpperCase() + 'ALGO' + randomHex(4).toUpperCase() + 'TESTNET';
  walletConnected = true;
  const btn = document.getElementById('walletBtn');
  btn.className = 'wallet-btn connected';
  btn.innerHTML = `<span class="wallet-dot"></span>${walletAddress.slice(0,6)}...${walletAddress.slice(-4)}`;
  closeWalletModal();
  toast('success', `${provider.charAt(0).toUpperCase()+provider.slice(1)} Connected`, `Address: ${walletAddress.slice(0,10)}...`);
  document.getElementById('profile-addr').textContent = walletAddress;
}

// â”€â”€ GENERATE NFT GRID â”€â”€
function renderNFTGrid(filter = 'all') {
  const grid = document.getElementById('nft-grid');
  grid.innerHTML = '';
  SAMPLE_NFTS
    .filter(n => filter === 'all' || n.type === filter || (filter === 'auction' && n.auction) || (filter === 'waived' && n.waived))
    .forEach(nft => {
      const card = document.createElement('div');
      card.className = 'nft-card' + (nft.type === 'rwa' ? ' rwa' : '') + (nft.auction ? ' auction' : '');
      card.onclick = () => showDetailModal(nft);

      const badges = [];
      if(nft.type === 'rwa') badges.push('<span class="badge badge-rwa">â¬¡ RWA</span>');
      if(nft.isAuth)   badges.push('<span class="badge badge-auth">âœ“ Auth</span>');
      if(nft.auction)  badges.push('<span class="badge badge-auction">â§‰ Auction</span>');
      if(nft.isRedeemed) badges.push('<span class="badge badge-redeemed">ğŸ“¦ Redeemed</span>');
      if(nft.waived)   badges.push('<span class="badge badge-waived">âŠ Royalty-Free</span>');
      if(nft.type === 'rwa' && !nft.isAuth) badges.push('<span class="badge badge-pending">â³ Pending Auth</span>');
      if(nft.decayMonths > 0 && !nft.waived) badges.push('<span class="badge badge-decaying">â± Decay</span>');

      const splitsBarHtml = nft.splits.map(s =>
        `<div class="split-seg" style="width:${s.pct}%;background:${s.color};"></div>`
      ).join('');

      const priceDisplay = nft.auction
        ? `<span class="meta-value gold">${nft.highBid} Èº bid</span>`
        : `<span class="meta-value gold">${nft.price} Èº</span>`;

      card.innerHTML = `
        <div class="card-art">
          <canvas class="art-canvas" data-colors="${encodeURIComponent(JSON.stringify(nft.colors))}" data-seed="${nft.id}"></canvas>
          <div class="card-badges">${badges.join('')}</div>
        </div>
        <div class="card-body">
          <div class="card-creator">${nft.creator}</div>
          <div class="card-name">${nft.name}</div>
          <div class="splits-bar">${splitsBarHtml}</div>
          <div class="card-meta">
            <div class="meta-item"><div class="meta-label">Price</div>${priceDisplay}</div>
            <div class="meta-item"><div class="meta-label">Royalty</div><div class="meta-value ${nft.waived ? 'red' : ''}">${nft.waived ? '0% (waived)' : nft.royalty + '%'}</div></div>
            <div class="meta-item"><div class="meta-label">Transfers</div><div class="meta-value">${nft.transfers}Ã—</div></div>
            <div class="meta-item"><div class="meta-label">Splits</div><div class="meta-value">${nft.splits.length}</div></div>
          </div>
          <div class="card-actions">
            ${nft.auction
              ? `<button class="btn btn-amber" onclick="event.stopPropagation();bidOnNFT(${nft.id})">â§‰ Bid</button>`
              : `<button class="btn btn-primary" onclick="event.stopPropagation();buyNFT(${nft.id})" ${nft.type==='rwa'&&!nft.isAuth?'disabled':''}>Buy</button>`
            }
            ${nft.buyout > 0 && !nft.waived ? `<button class="btn btn-violet" onclick="event.stopPropagation();buyOutRoyalty(${nft.id})" style="font-size:0.7rem;">âŠ Buy-Out</button>` : ''}
            <button class="btn btn-ghost" onclick="event.stopPropagation();showDetailModal(SAMPLE_NFTS[${nft.id-1}])">Â·Â·Â·</button>
          </div>
        </div>
        ${nft.auction ? `<div class="auction-bar"><span class="auction-label">â§‰ LIVE AUCTION</span><span class="auction-timer" id="timer-${nft.id}">Loading...</span></div>` : ''}
      `;
      grid.appendChild(card);
    });

  // Draw generative art
  grid.querySelectorAll('canvas[data-seed]').forEach(canvas => {
    const colors = JSON.parse(decodeURIComponent(canvas.dataset.colors));
    const seed = parseInt(canvas.dataset.seed);
    drawGenArt(canvas, colors, seed);
  });

  // Start auction timers
  SAMPLE_NFTS.filter(n => n.auction).forEach(n => startAuctionTimer(n.id));
}

function filterCards(filter) {
  document.querySelectorAll('[id^="f-"]').forEach(b => {
    b.className = b.id === 'f-' + filter ? 'btn btn-primary' : 'btn btn-ghost';
  });
  renderNFTGrid(filter);
}

// â”€â”€ GENERATIVE ART â”€â”€
function drawGenArt(canvas, colors, seed) {
  const size = canvas.parentElement.offsetWidth || 300;
  canvas.width = size;
  canvas.height = size;
  const ctx = canvas.getContext('2d');
  const rng = seededRng(seed);

  // Background
  const grad = ctx.createLinearGradient(0, 0, size, size);
  grad.addColorStop(0, colors[0] + '22');
  grad.addColorStop(1, colors[1] + '44');
  ctx.fillStyle = '#0f1119';
  ctx.fillRect(0, 0, size, size);
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, size, size);

  // Geometric shapes
  for(let i = 0; i < 18; i++) {
    const x = rng() * size;
    const y = rng() * size;
    const r = rng() * (size/4) + 10;
    const type = Math.floor(rng() * 3);
    ctx.globalAlpha = 0.12 + rng() * 0.3;
    ctx.fillStyle = colors[Math.floor(rng() * colors.length)];
    ctx.beginPath();
    if(type === 0) {
      ctx.arc(x, y, r, 0, Math.PI*2);
    } else if(type === 1) {
      ctx.rect(x-r/2, y-r/2, r, r);
    } else {
      ctx.moveTo(x, y-r); ctx.lineTo(x+r, y+r); ctx.lineTo(x-r, y+r);
    }
    ctx.fill();
  }

  // Grid lines
  ctx.globalAlpha = 0.06;
  ctx.strokeStyle = colors[2] || colors[0];
  ctx.lineWidth = 1;
  for(let i = 0; i < size; i += 40) {
    ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, size); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(size, i); ctx.stroke();
  }

  ctx.globalAlpha = 1;
}

function seededRng(seed) {
  let s = seed * 9301 + 49297;
  return () => { s = (s * 9301 + 49297) % 233280; return s / 233280; };
}

function randomHex(n) {
  return Array.from({length:n}, () => Math.floor(Math.random()*16).toString(16)).join('');
}

// â”€â”€ AUCTION TIMER â”€â”€
const auctionEnds = {};
function startAuctionTimer(id) {
  if(!auctionEnds[id]) auctionEnds[id] = Date.now() + (3600 + Math.random()*7200)*1000;
  const el = document.getElementById('timer-' + id);
  if(!el) return;
  const update = () => {
    const remaining = Math.max(0, auctionEnds[id] - Date.now());
    const h = Math.floor(remaining/3600000);
    const m = Math.floor((remaining%3600000)/60000);
    const s = Math.floor((remaining%60000)/1000);
    if(el) el.textContent = `${h}h ${m}m ${s}s`;
  };
  update();
  setInterval(update, 1000);
}

// â”€â”€ DETAIL MODAL â”€â”€
function showDetailModal(nft) {
  document.getElementById('dm-title').textContent = nft.name;
  const splitsHtml = nft.splits.map(s => `
    <div class="split-row">
      <div class="split-label">${s.label}</div>
      <div class="split-track"><div class="split-fill" style="width:${s.pct}%;background:${s.color};"></div></div>
      <div class="split-pct">${s.pct}%</div>
    </div>
  `).join('');

  const rwaHtml = nft.type === 'rwa' ? `
    <div class="physical-state">
      <div style="font-size:0.72rem;font-weight:700;color:var(--text2);letter-spacing:1px;text-transform:uppercase;margin-bottom:0.8rem;">RWA Physical Status</div>
      <div class="physical-timeline">
        <div class="timeline-step"><div class="timeline-dot done">âœ“</div><div class="timeline-label">Minted</div></div>
        <div class="timeline-step"><div class="timeline-dot ${nft.isAuth ? 'done' : 'current'}">
          ${nft.isAuth ? 'âœ“' : 'â³'}</div><div class="timeline-label">Authenticated</div></div>
        <div class="timeline-step"><div class="timeline-dot ${nft.isAuth ? 'done' : ''}">
          ${nft.isAuth ? 'âœ“' : 'â—¯'}</div><div class="timeline-label">Listed</div></div>
        <div class="timeline-step"><div class="timeline-dot ${nft.transfers>0?'done':''}">
          ${nft.transfers>0?'âœ“':'â—¯'}</div><div class="timeline-label">Sold</div></div>
        <div class="timeline-step"><div class="timeline-dot ${nft.isRedeemed?'done':''}">
          ${nft.isRedeemed?'âœ“':'â—¯'}</div><div class="timeline-label">Redeemed</div></div>
      </div>
    </div>` : '';

  document.getElementById('dm-body').innerHTML = `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:1.5rem;">
      <canvas id="dm-canvas" style="width:100%;aspect-ratio:1;border-radius:4px;display:block;"></canvas>
      <div>
        <div class="meta-item" style="margin-bottom:1rem;">
          <div class="meta-label">Creator</div>
          <div class="meta-value">${nft.creator}</div>
        </div>
        <div class="meta-item" style="margin-bottom:1rem;">
          <div class="meta-label">Unit Symbol</div>
          <div class="meta-value">${nft.unit}</div>
        </div>
        <div class="meta-item" style="margin-bottom:1rem;">
          <div class="meta-label">Ownership Transfers</div>
          <div class="meta-value">${nft.transfers}Ã—</div>
        </div>
        <div class="meta-item" style="margin-bottom:1rem;">
          <div class="meta-label">Royalty</div>
          <div class="meta-value">${nft.waived ? '<span style="color:var(--crimson)">0% (waived by buy-out)</span>' : nft.royalty + '%' + (nft.decayMonths > 0 ? ` â†’ ${nft.floor}% after ${nft.decayMonths}mo` : '')}</div>
        </div>
        ${nft.buyout > 0 && !nft.waived ? `<div class="meta-item"><div class="meta-label">Buy-Out Price</div><div class="meta-value gold">${nft.buyout} Èº</div></div>` : ''}
        ${nft.auction ? `<div class="meta-item" style="margin-top:0.7rem;"><div class="meta-label">Highest Bid</div><div class="meta-value gold" style="font-size:1.2rem;">${nft.highBid} Èº</div></div>` : ''}
      </div>
    </div>
    ${rwaHtml}
    <div style="margin-top:1.2rem;">
      <div style="font-size:0.72rem;font-weight:700;color:var(--text2);letter-spacing:1px;text-transform:uppercase;margin-bottom:1rem;">Royalty Split Breakdown</div>
      ${splitsHtml}
    </div>
    <div style="display:flex;gap:8px;margin-top:1.5rem;">
      ${nft.auction
        ? `<button class="btn btn-amber" style="flex:1;" onclick="closeDetailModal();bidOnNFT(${nft.id})">â§‰ Place Bid</button>`
        : `<button class="btn btn-primary" style="flex:1;" onclick="closeDetailModal();buyNFT(${nft.id})" ${nft.type==='rwa'&&!nft.isAuth?'disabled':''}>Buy Now${nft.price > 0 ? ' â€” ' + nft.price + ' Èº' : ''}</button>`
      }
      ${nft.buyout > 0 && !nft.waived ? `<button class="btn btn-violet" onclick="closeDetailModal();buyOutRoyalty(${nft.id})">âŠ Buy Out Royalties (${nft.buyout} Èº)</button>` : ''}
    </div>
  `;
  document.getElementById('detail-modal').style.display = 'flex';
  // Draw art in modal
  setTimeout(() => {
    const c = document.getElementById('dm-canvas');
    if(c) { c.width = 260; c.height = 260; drawGenArt(c, nft.colors, nft.id + 100); }
  }, 50);
}
function closeDetailModal(e) {
  if(!e || e.target === document.getElementById('detail-modal'))
    document.getElementById('detail-modal').style.display = 'none';
}

// â”€â”€ BUY / BID / BUYOUT â”€â”€
function buyNFT(id) {
  if(!walletConnected) { showWalletModal(); return; }
  const nft = SAMPLE_NFTS.find(n=>n.id===id);
  toast('info', 'Transaction Submitted', `Purchasing "${nft.name}" for ${nft.price} Èº...`);
  setTimeout(() => {
    nft.transfers++;
    toast('success', 'Purchase Complete!', `You now own "${nft.name}". Royalties distributed to ${nft.splits.length} recipients.`);
  }, 1800);
}
function bidOnNFT(id) {
  if(!walletConnected) { showWalletModal(); return; }
  const nft = SAMPLE_NFTS.find(n=>n.id===id);
  const newBid = nft.highBid + Math.ceil(nft.highBid * 0.1);
  toast('info', 'Bid Submitted', `Bid of ${newBid} Èº on "${nft.name}"`);
  setTimeout(() => {
    nft.highBid = newBid;
    toast('success', 'Bid Accepted!', `You are the highest bidder at ${newBid} Èº. Previous bidder refunded automatically.`);
  }, 1600);
}
function buyOutRoyalty(id) {
  if(!walletConnected) { showWalletModal(); return; }
  const nft = SAMPLE_NFTS.find(n=>n.id===id);
  toast('warning', 'Royalty Buy-Out', `Paying ${nft.buyout} Èº to permanently remove royalties from "${nft.name}"...`);
  setTimeout(() => {
    nft.waived = true;
    nft.buyout = 0;
    toast('success', 'Royalties Waived!', `All future sales of "${nft.name}" will incur 0% royalty. Creator received ${(nft.buyout*0.95).toFixed(0)} Èº buy-out payment.`);
    renderNFTGrid();
  }, 2000);
}

// â”€â”€ MINT SINGLE â”€â”€
function updateMintPreview() {
  const name = document.getElementById('m-name').value || 'NFT Name';
  const unit = document.getElementById('m-unit').value || 'UNIT';
  const price = parseFloat(document.getElementById('m-price').value) || 0;
  const royalty = parseFloat(document.getElementById('m-royalty').value);
  const floor = parseFloat(document.getElementById('m-floor').value) || 0;
  const buyout = parseFloat(document.getElementById('m-buyout').value) || 0;
  const decay = parseInt(document.getElementById('m-decay').value) || 0;

  document.getElementById('m-royalty-val').textContent = royalty + '%';
  document.getElementById('prev-name').textContent = name;
  document.getElementById('prev-unit').textContent = unit;
  document.getElementById('prev-price').textContent = price > 0 ? price + ' Èº' : 'â€”';
  document.getElementById('prev-royalty').textContent = royalty + '%';
  document.getElementById('prev-floor').textContent = decay > 0 ? `${floor}% after ${Math.ceil(decay/777600)} mo` : 'No decay';
  document.getElementById('prev-buyout').textContent = buyout > 0 ? buyout + ' Èº' : 'Disabled';

  // Split viz
  const creatorPct = royalty;
  const musePct = 2.5;
  const sellerPct = 100 - creatorPct - musePct;
  document.getElementById('prev-split-viz').innerHTML = `
    <div class="split-row"><div class="split-label">Creator</div><div class="split-track"><div class="split-fill" style="width:${creatorPct}%;background:var(--gold);"></div></div><div class="split-pct">${creatorPct}%</div></div>
    <div class="split-row"><div class="split-label">Muse Fee</div><div class="split-track"><div class="split-fill" style="width:${musePct}%;background:var(--violet);"></div></div><div class="split-pct">${musePct}%</div></div>
    <div class="split-row"><div class="split-label">Seller</div><div class="split-track"><div class="split-fill" style="width:${sellerPct}%;background:var(--sapphire);"></div></div><div class="split-pct">${sellerPct.toFixed(1)}%</div></div>
  `;

  // Decay visualization
  if(decay > 0) {
    document.getElementById('decay-info').textContent = `${royalty}% â†’ ${floor}% in ~${Math.ceil(decay/777600)}mo`;
    document.getElementById('decay-fill').style.width = '100%';
  } else {
    document.getElementById('decay-info').textContent = `${royalty}% â†’ no decay`;
    document.getElementById('decay-fill').style.width = '100%';
  }

  drawPreviewCanvas();
}

function drawPreviewCanvas() {
  const canvas = document.getElementById('preview-canvas');
  if(!canvas) return;
  const size = canvas.parentElement.offsetWidth || 300;
  canvas.width = size; canvas.height = size;
  drawGenArt(canvas, ['#d4a843','#2d7fca','#1fa86e'], Math.floor(Math.random()*100));
}

function mintSingleNFT() {
  if(!walletConnected) { showWalletModal(); return; }
  const name = document.getElementById('m-name').value;
  if(!name) { toast('error', 'Missing Fields', 'Please enter an NFT name.'); return; }
  toast('info', 'Transaction Submitted', `Minting "${name}" on Algorand testnet...`);
  setTimeout(() => {
    toast('success', 'Minted!', `"${name}" is now live on the marketplace. ARC-69 metadata stored on-chain.`);
  }, 2000);
}

// â”€â”€ MINT TABS â”€â”€
function showMintTab(tab) {
  ['single','batch','collab'].forEach(t => {
    document.getElementById('mint-'+t).style.display = t===tab ? '' : 'none';
  });
  document.querySelectorAll('.inner-tab').forEach((b,i) => {
    b.classList.toggle('active', ['single','batch','collab'][i] === tab);
  });
}

// â”€â”€ BATCH MINT â”€â”€
function addBatchItem() {
  const name = document.getElementById('b-name').value;
  const price = document.getElementById('b-price').value;
  const royalty = document.getElementById('b-royalty').value;
  if(!name) return;
  batchItems.push({name, price, royalty});
  renderBatchList();
  document.getElementById('b-name').value = '';
}
function renderBatchList() {
  const list = document.getElementById('batch-list');
  list.innerHTML = batchItems.map((item,i) => `
    <div class="batch-item">
      <div class="batch-num">${i+1}</div>
      <div class="batch-info">
        <div class="batch-name">${item.name}</div>
        <div class="batch-meta">${item.price} Èº Â· ${item.royalty}% royalty</div>
      </div>
      <button class="batch-remove" onclick="removeBatch(${i})">âœ•</button>
    </div>
  `).join('');
  document.getElementById('batch-count').textContent = batchItems.length + ' items';
}
function removeBatch(i) { batchItems.splice(i,1); renderBatchList(); }
function executeBatchMint() {
  if(!walletConnected) { showWalletModal(); return; }
  if(batchItems.length === 0) { toast('error','Empty Queue','Add items before batch minting.'); return; }
  toast('info','Batch Mint Initiated', `Submitting ${batchItems.length} NFTs in sequence...`);
  let i = 0;
  const interval = setInterval(() => {
    if(i >= batchItems.length) { clearInterval(interval); toast('success','Batch Complete!', `All ${batchItems.length} NFTs minted successfully.`); batchItems=[]; renderBatchList(); return; }
    toast('info',`Minting ${i+1}/${batchItems.length}`, `"${batchItems[i].name}" submitted.`);
    i++;
  }, 600);
}

// â”€â”€ COLLAB SLOTS â”€â”€
function initCollabSlots() {
  const el = document.getElementById('collab-slots');
  if(!el) return;
  el.innerHTML = COLLAB_ROLES.map((role,i) => `
    <div class="role-slot">
      <div class="role-icon ${role.cls}">${role.icon}</div>
      <div>
        <div class="role-name">${role.label}</div>
        <input type="text" placeholder="ALGO address" id="co-addr-${i}" style="margin-top:6px;background:var(--bg0);border:1px solid var(--line);border-radius:3px;padding:6px 10px;color:var(--text0);font-family:'Syne Mono',monospace;font-size:0.72rem;width:100%;" oninput="updateCollabSplits()"/>
      </div>
      <div>
        <div class="meta-label" style="margin-bottom:4px;">Share %</div>
        <input type="number" placeholder="25" min="0" max="100" id="co-share-${i}" style="width:70px;background:var(--bg0);border:1px solid var(--line);border-radius:3px;padding:6px 8px;color:var(--gold);font-family:'Syne Mono',monospace;font-size:0.82rem;" oninput="updateCollabSplits()"/>
      </div>
      <div class="role-status status-pending" id="co-status-${i}">PENDING</div>
    </div>
  `).join('');
}

function updateCollabSplits() {
  let total = 0;
  for(let i=0;i<4;i++) {
    const s = parseFloat(document.getElementById('co-share-'+i)?.value) || 0;
    total += s;
  }
  const bar = document.getElementById('collab-total-bar');
  const pct = document.getElementById('collab-total-pct');
  if(bar) bar.style.width = Math.min(100, total) + '%';
  if(bar) bar.style.background = total > 100 ? 'var(--crimson)' : total === 100 ? 'var(--emerald)' : 'var(--gold)';
  if(pct) pct.textContent = total.toFixed(0) + ' / 100%';
  if(pct) pct.style.color = total > 100 ? 'var(--crimson)' : total === 100 ? 'var(--emerald)' : 'var(--text0)';
}

function simulateAcceptance() {
  for(let i=0;i<4;i++) {
    const el = document.getElementById('co-status-'+i);
    if(el && document.getElementById('co-addr-'+i)?.value) {
      setTimeout(() => {
        el.textContent = 'ACCEPTED';
        el.className = 'role-status status-accepted';
      }, (i+1)*600);
    }
  }
  toast('info','Simulating Acceptance','Each co-creator sending accept_collaboration() transaction...');
}

function mintCollab() {
  if(!walletConnected) { showWalletModal(); return; }
  toast('info','Collaboration NFT Submitted','Minting with co-creator registry. Pending acceptances recorded on-chain...');
  setTimeout(() => toast('success','Minted!','NFT live. Co-creators have been notified to accept their roles.'), 2000);
}

// â”€â”€ RWA ROLES â”€â”€
function initRWARoleSlots() {
  const el = document.getElementById('rwa-role-slots');
  if(!el) return;
  el.innerHTML = COLLAB_ROLES.map((role,i) => `
    <div style="display:grid;grid-template-columns:32px 1fr 140px 80px;gap:8px;align-items:center;margin-bottom:10px;">
      <div class="role-icon ${role.cls}" style="width:28px;height:28px;font-size:0.8rem;">${role.icon}</div>
      <input type="text" placeholder="${role.label} address" id="r-co-addr-${i}" style="background:var(--bg0);border:1px solid var(--line);border-radius:3px;padding:7px 10px;color:var(--text0);font-family:'Syne Mono',monospace;font-size:0.72rem;"/>
      <input type="text" placeholder="Role (e.g. Athlete)" id="r-co-role-${i}" value="${role.label}" style="background:var(--bg0);border:1px solid var(--line);border-radius:3px;padding:7px 10px;color:var(--text0);font-size:0.72rem;font-family:'Syne',sans-serif;"/>
      <div style="display:flex;align-items:center;gap:4px;">
        <input type="number" placeholder="%" id="r-co-share-${i}" min="0" max="100" style="background:var(--bg0);border:1px solid var(--line);border-radius:3px;padding:7px 8px;color:var(--gold);font-family:'Syne Mono',monospace;font-size:0.82rem;width:100%;"/>
      </div>
    </div>
  `).join('');
}

function mintRWA() {
  if(!walletConnected) { showWalletModal(); return; }
  const name = document.getElementById('r-name').value;
  if(!name) { toast('error','Missing Fields','Enter a name for the RWA.'); return; }
  toast('info','RWA Token Submitted', `Minting "${name}" â€” awaiting authenticator approval before going live.`);
  setTimeout(() => toast('success','RWA Minted!', 'Token created in PENDING state. Authenticator must call validate_physical_asset() to activate listing.'), 2200);
}

// â”€â”€ RWA AUCTION SIMULATION â”€â”€
function initRWAAuction() {
  auctionBids = [
    { bidder: 'VAULT...A3K2', amount: 10000, winning: false },
    { bidder: 'ATHL...B9X1', amount: 11500, winning: false },
    { bidder: 'ANON...ZZ42', amount: 12000, winning: true },
  ];
  renderBidHistory();
  if(!auctionEndTime) auctionEndTime = Date.now() + 4*3600*1000;
  if(auctionInterval) clearInterval(auctionInterval);
  auctionInterval = setInterval(() => {
    const remaining = Math.max(0, auctionEndTime - Date.now());
    const h = Math.floor(remaining/3600000);
    const m = Math.floor((remaining%3600000)/60000);
    const s = Math.floor((remaining%60000)/1000);
    const el = document.getElementById('auction-timer');
    if(el) el.textContent = `${h}h ${m}m ${s}s`;
    const hb = document.getElementById('auction-high');
    if(hb) hb.textContent = Math.max(...auctionBids.map(b=>b.amount)) + ' Èº';
  }, 1000);
}
function renderBidHistory() {
  const list = document.getElementById('bid-history-list');
  if(!list) return;
  list.innerHTML = auctionBids.map(b => `
    <div class="bid-row ${b.winning?'winning':''}">
      <span class="${b.winning?'bid-winner':''}">${b.winning?'ğŸ‘‘ ':''} ${b.bidder}</span>
      <span class="bid-amount">${b.amount} Èº</span>
    </div>
  `).join('');
}
function placeBid() {
  if(!walletConnected) { showWalletModal(); return; }
  const amt = parseFloat(document.getElementById('bid-amount').value);
  const max = Math.max(...auctionBids.map(b=>b.amount));
  if(!amt || amt <= max) { toast('error','Invalid Bid', `Bid must exceed current highest of ${max} Èº.`); return; }
  auctionBids.forEach(b => b.winning = false);
  auctionBids.push({ bidder: walletAddress.slice(0,4)+'...'+walletAddress.slice(-4), amount: amt, winning: true });
  renderBidHistory();
  toast('success','Bid Placed!', `You bid ${amt} Èº. Previous bidder refunded automatically by contract.`);
}

// â”€â”€ RWA SIMULATION BUTTONS â”€â”€
function simulateAuthenticate() {
  document.getElementById('tl-auth').className = 'timeline-dot done';
  document.getElementById('tl-auth').textContent = 'âœ“';
  document.getElementById('tl-listed').className = 'timeline-dot current';
  document.getElementById('tl-listed').textContent = 'â³';
  toast('success','Asset Authenticated!','validate_physical_asset() called by certified authenticator. NFT is now LIVE on marketplace.');
}
function simulateRedeem() {
  document.getElementById('tl-listed').className = 'timeline-dot done';
  document.getElementById('tl-listed').textContent = 'âœ“';
  document.getElementById('tl-sold').className = 'timeline-dot done';
  document.getElementById('tl-sold').textContent = 'âœ“';
  document.getElementById('tl-redeemed').className = 'timeline-dot done';
  document.getElementById('tl-redeemed').textContent = 'âœ“';
  toast('success','Physical Item Redeemed!','redeem_physical_asset() executed. Tracking info stored on-chain. NFT locked from further sales.');
}
function simulateStartAuction() {
  toast('info','Auction Started','start_auction() submitted with 48h duration. NFT now in auction mode.');
  setTimeout(() => toast('success','Auction Live!','First bid threshold set. Bidders can now call place_bid().'), 1500);
}

// â”€â”€ ANALYTICS CHARTS â”€â”€
let chartsInit = false;
function initCharts() {
  if(chartsInit) return;
  chartsInit = true;

  const chartOpts = {
    responsive: true,
    plugins: { legend: { labels: { color: '#7a7f9a', font: { family: 'Syne' } } } },
    scales: {
      x: { ticks: { color: '#7a7f9a' }, grid: { color: '#2a2f42' } },
      y: { ticks: { color: '#7a7f9a' }, grid: { color: '#2a2f42' } }
    }
  };

  const months = ['Sep','Oct','Nov','Dec','Jan','Feb'];
  const volData = [320, 580, 420, 890, 1240, 768];

  new Chart(document.getElementById('chart-volume'), {
    type: 'line',
    data: {
      labels: months,
      datasets: [{
        label: 'Volume (Èº)',
        data: volData,
        borderColor: '#d4a843',
        backgroundColor: 'rgba(212,168,67,0.08)',
        fill: true, tension: 0.4,
        pointBackgroundColor: '#d4a843',
      }]
    },
    options: chartOpts
  });

  new Chart(document.getElementById('chart-category'), {
    type: 'doughnut',
    data: {
      labels: ['Digital NFT', 'RWA Authenticated', 'RWA Pending', 'Royalty-Free'],
      datasets: [{
        data: [68, 16, 10, 6],
        backgroundColor: ['#2d7fca','#1fa86e','#e07b1a','#7c4dcc'],
        borderColor: '#0f1119', borderWidth: 3
      }]
    },
    options: { responsive: true, plugins: { legend: { labels: { color: '#7a7f9a', font:{family:'Syne'} } } } }
  });

  // Decay simulation chart
  const decayLabels = Array.from({length:25}, (_,i) => i===0?'Now':(i%6===0?`${i}mo`:''));
  const decayValues = Array.from({length:25}, (_,i) => i < 12 ? 10 - (i/12)*5 : 5);
  new Chart(document.getElementById('chart-decay'), {
    type: 'line',
    data: {
      labels: decayLabels,
      datasets: [{
        label: 'Royalty % (10% â†’ 5%)',
        data: decayValues,
        borderColor: '#cc3a3a',
        backgroundColor: 'rgba(204,58,58,0.07)',
        fill: true, stepped: false, tension: 0,
        pointBackgroundColor: '#cc3a3a',
      }]
    },
    options: { ...chartOpts, scales: { ...chartOpts.scales, y: { ...chartOpts.scales.y, min: 0, max: 12 } } }
  });

  new Chart(document.getElementById('chart-artists'), {
    type: 'bar',
    data: {
      labels: ['Studio Meridian', 'Sports Vault', 'Pixel Anarchy', 'Heritage Auth', 'Void.art'],
      datasets: [{
        label: 'Volume (Èº)',
        data: [892, 4200, 320, 1100, 88],
        backgroundColor: ['#d4a843','#1fa86e','#c94d8a','#e07b1a','#2d7fca'],
      }]
    },
    options: chartOpts
  });
}

function updateDecayCalc() {
  const init = parseFloat(document.getElementById('calc-init').value) || 10;
  const floor = parseFloat(document.getElementById('calc-floor').value) || 5;
  const months = parseInt(document.getElementById('calc-months').value) || 12;
  const rounds = months * 777600;
  document.getElementById('decay-calc-output').innerHTML =
    `Initial royalty: <span style="color:var(--gold)">${init}%</span>   |   ` +
    `Floor after ${months} months: <span style="color:var(--crimson)">${floor}%</span><br/>` +
    `Decay begins at round offset: <span style="color:var(--sapphire)">${rounds.toLocaleString()}</span>   (~${months} months Ã— 777,600 rounds/month)<br/>` +
    `Total reduction: <span style="color:var(--emerald)">${(init-floor).toFixed(1)}%</span> over ${months} months â€” then permanently held at ${floor}%`;
}

// â”€â”€ PROFILE â”€â”€
function initProfile() {
  // Draw avatar
  const c = document.getElementById('avatar-canvas');
  if(c) { c.width=80; c.height=80; drawGenArt(c,['#d4a843','#2d7fca','#1fa86e'],42); }

  // Collab invites
  const invites = document.getElementById('collab-invites');
  if(invites) invites.innerHTML = `
    <div class="batch-item">
      <div class="batch-num">1</div>
      <div class="batch-info">
        <div class="batch-name">"Finals Reel #07"</div>
        <div class="batch-meta">Studio Meridian Â· 30% of 10% royalty Â· Role: Photographer</div>
      </div>
      <button class="btn btn-green" style="padding:6px 14px;font-size:0.72rem;" onclick="acceptCollab(this)">Accept</button>
    </div>
    <div class="batch-item">
      <div class="batch-num">2</div>
      <div class="batch-info">
        <div class="batch-name">"Championship Drop"</div>
        <div class="batch-meta">Sports Vault Â· 25% of 15% royalty Â· Role: Team/League</div>
      </div>
      <button class="btn btn-green" style="padding:6px 14px;font-size:0.72rem;" onclick="acceptCollab(this)">Accept</button>
    </div>
  `;

  // Buy-out offers
  const offers = document.getElementById('buyout-offers');
  if(offers) offers.innerHTML = `
    <div class="batch-item">
      <div class="batch-num">ğŸ’</div>
      <div class="batch-info">
        <div class="batch-name">"Solstice Bloom #07"</div>
        <div class="batch-meta">Offer: 500 Èº Â· Current royalty: 10%</div>
      </div>
      <button class="btn btn-violet" style="padding:6px 14px;font-size:0.72rem;" onclick="acceptBuyout(this)">Review</button>
    </div>
  `;
}

function acceptCollab(btn) {
  btn.textContent = 'âœ“ Accepted';
  btn.className = 'btn btn-ghost';
  btn.disabled = true;
  toast('success','Collaboration Accepted','accept_collaboration() signed on-chain. Your role and royalty share are now active.');
}
function acceptBuyout(btn) {
  btn.textContent = 'Accepting...';
  toast('warning','Buy-Out Offer','Reviewing buy_out_royalty() terms. Transaction will permanently waive future royalties.');
}

// â”€â”€ TOAST â”€â”€
function toast(type, title, msg) {
  const icons = { success:'âœ“', error:'âœ•', info:'â„¹', warning:'âš ' };
  const el = document.createElement('div');
  el.className = 'toast ' + type;
  el.innerHTML = `<div class="toast-icon">${icons[type]||'â€¢'}</div><div class="toast-body"><div class="toast-title">${title}</div><div class="toast-msg">${msg}</div></div>`;
  const container = document.getElementById('toasts');
  container.appendChild(el);
  setTimeout(() => el.remove(), 5000);
}

// â”€â”€ INIT â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  renderNFTGrid();
  initCollabSlots();
  initRWARoleSlots();
  updateMintPreview();
  drawPreviewCanvas();

  // Animate stats counter
  animateStat('stat-volume', 4218, 'Èº');
  animateStat('stat-minted', 1847, '');
  animateStat('stat-auctions', 7, '');
});

function animateStat(id, target, suffix) {
  let current = 0;
  const el = document.getElementById(id);
  if(!el) return;
  const step = target / 60;
  const interval = setInterval(() => {
    current = Math.min(current + step, target);
    el.textContent = Math.floor(current).toLocaleString() + (suffix ? ' ' + suffix : '');
    if(current >= target) clearInterval(interval);
  }, 20);
}
</script>
</body>
</html>
